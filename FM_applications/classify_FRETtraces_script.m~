%%  startup
close all, clear all, clc

% load traces
tmp1 = load('/Volumes/JonasStorage/FM_data/session2/2015-05-22_18-59_analysis/data.mat');
tmp2 = load('/Volumes/JonasStorage/FM_data/session3_200ms/2015-05-22_20-20_analysis/data.mat');
tmp3 = load('/Volumes/JonasStorage/FM_data/session4_200ms/2015-05-23_11-05_analysis/data.mat');



%% loop through traces and compute FRET / print traces

for i=1:n_traces
    
    Idd = traces{i,1}(:,4);
    Ida = traces{i,2}(:,4);
    
    x_dd = traces{i,1}(1,2)+1;
    y_dd = traces{i,1}(1,3)+1;
    x_da = traces{i,2}(1,2)+1;
    y_da = traces{i,2}(1,3)+1;
    x_aa = traces{i,3}(1,2)+1;
    y_aa = traces{i,3}(1,3)+1;
    
    subplot(3,4, [1,5,9])
    imagesc(avg_img{traces{i,4},3}), colormap gray, axis image, hold on
    plot(x_aa, y_aa, 'r.', 'MarkerSize', 15 )
    %ellipse(r_integrate, r_integrate, 0, x_aa, y_aa, 'r');
    
    subplot(3,4, 2:4)
    plot(traces{i,1}(:,1), traces{i,1}(:,4), 'g-', traces{i,2}(:,1), traces{i,2}(:,4), 'b-',  'Linewidth', 1)
     ylabel('Integr. Intensity')
    title([num2str(i) ' of ' num2str(size(traces,1))])
    
    subplot(3,4, 6:8)
    plot(traces{i,3}(:,1), traces{i,3}(:,4), 'r',  'Linewidth', 1)
    ylabel('Integr. Intensity')
        
    subplot(3,4, 10:12)
    plot(traces{i,1}(:,1), Ida ./ (Idd+Ida), 'k', 'Linewidth', 1)

    xlabel('Framenumber'), ylabel('E_app')
    set(gca, 'YLim', [min(Ida ./ (Idd+Ida)) max(Ida ./ (Idd+Ida))])
    set(gca, 'YLim', [0.3 0.6])
    %print(cur_fig, '-dtiff', '-r300', [path_fig filesep 'trace_' sprintf('%.03i',i) '.tif'])

    print_str = questdlg('Discard or save', 'Discard or save?', 'Discard','Save and print', 'Discard');
end

